<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Oliver vCard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    /* Layout & Design */
    body, html {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }

    header {
      background: linear-gradient(to right, #00aaff, #005577);
      color: white;
      padding: 30px;
      text-align: center;
      font-size: 1.5rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Ensuring responsiveness */
    .section {
      margin-bottom: 30px;
    }

    .social-icons a img {
      width: 32px;
      height: 32px;
      margin-right: 10px;
    }

    .social-icons a {
      color: white;
      text-decoration: none;
    }

    /* Modal Styling */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.4);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 500px;
      text-align: center;
    }

    /* Buttons */
    .download-btn, .modal-button {
      background-color: #005577;
      color: white;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .download-btn:hover, .modal-button:hover {
      background-color: #0077aa;
    }

    .close {
      color: #aaa;
      font-size: 30px;
      font-weight: bold;
      position: absolute;
      right: 10px;
      top: 10px;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    .error-message {
      color: red;
      font-size: 0.9rem;
      display: none;
    }

    .success-message {
      color: green;
      font-size: 1rem;
      display: none;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      background-color: #222;
      color: white;
    }

    /* Media Queries for responsiveness */
    @media (max-width: 768px) {
      header {
        font-size: 1.2rem;
        padding: 20px;
      }

      .container {
        padding: 10px;
      }

      .modal-content {
        width: 90%;
        max-width: 400px;
      }
    }

    @media (max-width: 480px) {
      header {
        font-size: 1rem;
        padding: 15px;
      }

      .social-icons a img {
        width: 25px;
        height: 25px;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <h1>Welcome to Oliver's vCard</h1>
  </header>

  <!-- Container -->
  <div class="container">

    <!-- Social Media -->
    <section class="social-section section">
      <h3>Social Media</h3>
      <div class="social-icons">
        <a href="https://wa.me/+12817839998" target="_blank" aria-label="WhatsApp">
          <img src="https://cdn-icons-png.flaticon.com/512/124/124034.png" alt="WhatsApp Icon" />
          <span>WhatsApp</span>
        </a>
        <a href="https://linkedin.com/in/oliver-f-448b8a287" target="_blank" aria-label="LinkedIn">
          <img src="https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png" alt="LinkedIn Icon" />
          <span>LinkedIn</span>
        </a>
      </div>
    </section>

    <!-- Download vCard -->
    <div class="download-section section">
      <button id="downloadVCardBtn" class="download-btn">
        <i class="fas fa-user-plus"></i>
        DOWNLOAD VCARD
      </button>
    </div>

    <!-- vCard Modal -->
    <div id="vcardModal" class="modal">
      <div class="modal-content">
        <span class="close" aria-label="Close">&times;</span>
        <h2>Save Contact Data</h2>
        <p>How would you like to save contact data?</p>
        <button id="savePhoneBtn" class="modal-button">To My iPhone</button>
        <button id="saveEmailBtn" class="modal-button">Save via Email</button>
      </div>
    </div>

    <!-- Email Modal -->
    <div id="emailModal" class="modal">
      <div class="modal-content">
        <span class="close" aria-label="Close">&times;</span>
        <h2>Send vCard via Email</h2>
        <form id="emailForm">
          <input type="email" name="user_email" placeholder="Enter your email" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"/>
          <span class="error-message" id="emailError">请输入有效的电子邮件地址。</span>
          <button type="submit" class="modal-button">Send Email</button>
        </form>
        <p id="emailStatus" class="success-message"></p>
      </div>
    </div>

    <!-- Contact Section -->
    <div class="page-section" id="contactSection">
      <span class="section-close-btn" onclick="goHome()">x</span>
      <div class="contact-content">
        <h2>Contact Us</h2>
        <p>We appreciate your interest. Please fill out the form below:</p>
        <form id="contactForm">
          <input type="text" name="from_name" placeholder="Your Name" required />
          <input type="email" name="reply_to" placeholder="Your Email" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" />
          <span class="error-message" id="contactEmailError">请输入有效的电子邮件地址。</span>
          <textarea name="message" rows="5" placeholder="Your Message" required></textarea>
          <button type="submit">Send Message</button>
        </form>
        <p id="contactStatus" class="success-message"></p>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <p>&copy; 2024 A huge fan. All Rights Reserved.</p>
    </footer>

  </div>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("HXCThZROMytOt-wyp"); // Replace with your EmailJS public key
    })();

    document.addEventListener('DOMContentLoaded', () => {
      const vcardModal = document.getElementById('vcardModal');
      const emailModal = document.getElementById('emailModal');
      const downloadVCardBtn = document.getElementById('downloadVCardBtn');
      const closeBtns = document.querySelectorAll('.close');
      const savePhoneBtn = document.getElementById('savePhoneBtn');
      const saveEmailBtn = document.getElementById('saveEmailBtn');
      const emailForm = document.getElementById('emailForm');
      const emailStatus = document.getElementById('emailStatus');
      const emailError = document.getElementById('emailError');
      const contactForm = document.getElementById('contactForm');
      const contactStatus = document.getElementById('contactStatus');
      const contactEmailError = document.getElementById('contactEmailError');

      // Email Format Validation
      function validateEmail(email) {
        const re = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/;
        return re.test(String(email).toLowerCase());
      }

      // vCard Modal open
      downloadVCardBtn.onclick = () => {
        vcardModal.style.display = 'block';
      };

      // Close modals
      closeBtns.forEach(btn => {
        btn.onclick = () => {
          vcardModal.style.display = 'none';
          emailModal.style.display = 'none';
        };
      });

      // Outside click to close modals
      window.onclick = (event) => {
        if (event.target === vcardModal) vcardModal.style.display = 'none';
        if (event.target === emailModal) emailModal.style.display = 'none';
      };

      // ESC key to close modals
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          vcardModal.style.display = 'none';
          emailModal.style.display = 'none';
        }
      });

      // Save to iPhone button
      savePhoneBtn.onclick = () => {
        vcardModal.style.display = 'none';
        window.location.href = 'OliverF.vcf';
      };

      // Save via Email button
      saveEmailBtn.onclick = () => {
        vcardModal.style.display = 'none';
        emailModal.style.display = 'block';
      };

      // Email form submit (prevents duplicate submission on same day)
      emailForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const userEmail = emailForm.user_email.value.trim();
        const today = new Date().toISOString().split('T')[0]; // Get current date

        // Check if email is valid
        if (!validateEmail(userEmail)) {
          emailError.style.display = 'block';
          emailStatus.textContent = '';
          return;
        } else {
          emailError.style.display = 'none';
        }

        emailStatus.textContent = "Sending...";
        emailStatus.style.color = "black";

        // Send email via EmailJS
        emailjs.send('service_1ffkva1', 'template_ypdj9n9', {
          to_email: userEmail,
          message: 'Please download your vCard from: https://forest-fr.github.io/oliver-vcard/OliverF.vcf'
        }).then((resp) => {
          console.log('SUCCESS!', resp.status, resp.text);
          emailStatus.style.color = 'green';
          emailStatus.textContent = 'Email sent successfully! Check your inbox.';
          emailForm.reset();
          setTimeout(() => {
            emailModal.style.display = 'none';
            emailStatus.textContent = '';
          }, 3000);
        }).catch((err) => {
          console.log('FAILED...', err);
          emailStatus.style.color = 'red';
          emailStatus.textContent = 'Failed to send email. Try again later.';
        });
      });

      // Contact form submit (prevents duplicate submission on same day)
      contactForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const contactEmail = contactForm.reply_to.value.trim();

        // Validate email format
        if (!validateEmail(contactEmail)) {
          contactEmailError.style.display = 'block';
          contactStatus.textContent = '';
          return;
        } else {
          contactEmailError.style.display = 'none';
        }

        contactStatus.textContent = "Sending...";
        contactStatus.style.color = "black";

        // Send message via EmailJS
        emailjs.send('service_1ffkva1', 'template_o5n5jrp', {
          from_name: contactForm.from_name.value.trim(),
          reply_to: contactEmail,
          message: contactForm.message.value.trim()
        }).then((resp) => {
          console.log("SUCCESS!", resp.status, resp.text);
          contactStatus.style.color = 'green';
          contactStatus.textContent = 'Your message was sent successfully! We will reply soon.';
          contactForm.reset();
        }).catch((err) => {
          console.log("FAILED...", err);
          contactStatus.style.color = 'red';
          contactStatus.textContent = 'Failed to send. Please try again.';
        });
      });
    });
  </script>
</body>
</html>
